const express = require("express");
const bodyParser = require("body-parser");
const cors = require("cors");
const MongoClient = require("mongodb").MongoClient;
const ObjectId = require("mongodb").ObjectId;
require("dotenv").config();

const app = express();
app.use(bodyParser.json());
app.use(cors());
const port = 5000;
const url = process.env.DB_URL;
const dbname = "burjAlArab";

MongoClient.connect(url, (err, client) => {
    console.log("con");
    const db = client.db(dbname);
    const bookings = db.collection("bookings");
    app.post("/addBooking", (req, res) => {
        const newBooking = req.body;
        bookings.insertOne(newBooking).then((result) => {
            res.send(result.insertedCount > 0);
        });
        console.log(newBooking);
    });
    app.get("/bookings", (req, res) => {
        bookings.find({ email: req.query.email }).toArray((err, documents) => {
            res.send(documents);
        });
    });
});

app.get("/", (req, res) => {
    res.send("Hello world!");
});

app.listen(port, () => {
    console.log("Example app listening to localhost:5000");
});
